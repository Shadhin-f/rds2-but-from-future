<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5572277246422121"
      crossorigin="anonymous"
    ></script>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-DR0D2D6C35"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-DR0D2D6C35");
    </script>
    <meta charset="UTF-8" />
    <title>Study Materials</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" sizes="32x32" href="images/index.png" />
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .trending-link {
        box-shadow: 0 0 8px 2px #e11d48, 0 0 16px 4px #be185d;
        border-color: #e11d48 !important;
        color: #fff !important;
        position: relative;
        z-index: 2;
      }
      .trending-link:hover {
        box-shadow: 0 0 16px 4px #e11d48, 0 0 24px 8px #be185d;
        background: linear-gradient(135deg, #e11d48, #be185d) !important;
        color: #fff !important;
      }
      .study-material-frame {
        width: 100%;
        height: 80vh;
        border: none;
        margin: 0 auto;
        display: block;
        background-color: #1a1c23;
        border-radius: 8px;
        border: 1px solid #334155;
        box-shadow: 0 0 8px 2px #777677, 0 0 16px 4px #4b2591e5;
      }
    </style>
  </head>
  <body>
    <canvas id="particleCanvas"></canvas>
    <div class="container">
      <header>
        <h1>Study Materials</h1>
        <nav class="nav-bar">
          <a href="index.html">RDS2</a>
          <a href="calendar.html">Academic Calendar</a>
          <a href="resources.html" class="active">Study Materials</a>
          <a href="routine.html">Routine Maker</a>
          <a href="planner.html">Semester Planner</a>
          <a href="freshman.html">Freshman Guides</a>
          <a href="coursemap.html">Course map</a>
          <a href="booksearch.html">NSU Library Book Locator</a>
          <a href="shelf_search.html">Library Shelf Finder</a>
          <a href="cgpa.html">CGPA Calculator</a>
          <a href="retake.html">Retake Calculator</a>
        </nav>
        <!-- <div class="header-counters">
                <div id="totalResourcesCounter" class="active-users-counter">üì¶ 0 resources shared</div>
                <div id="pageActiveUsers" class="active-users-counter">üü¢ 0 active viewers</div>
            </div> -->
        <div class="announcement-bar">
          <a
            href="https://forms.gle/LHJ9YfGUBTPLTbZo8"
            target="_blank"
            class="view-extension-btn"
            >üõ©Ô∏è Share material!</a
          >
          <a
            href="https://docs.google.com/spreadsheets/d/1mTTsmqo_F-6SyiGJSFJgMu_rMPB4LxSBVOUHypiM3rk/edit?usp=sharing"
            target="_blank"
            class="view-extension-btn"
            >üîé View in sheets!</a
          >
        </div>
        <div class="announcement-bar">
          <p>
            üìö Let‚Äôs grow together! Share your study materials‚Äînotes, slides,
            summaries, or tips‚Äîand help others succeed while building a stronger
            learning community. You'll also get access to helpful resources
            shared by fellow students. By keeping everything in one place, it
            becomes easier and faster for everyone to find what they need, when
            they need it. Let's make studying simpler, together! üåü
          </p>
        </div>
      </header>

      <main>
        <iframe
          class="study-material-frame"
          src="https://docs.google.com/spreadsheets/d/e/2PACX-1vSIqjfpp6kuuUVPRwcQ3ASGDc8PqrmEYWH2XBzc0XUpQejgJgIqsYPKaIcf_fK_mSAMfYnYkDkRCtSh/pubhtml?widget=true&amp;headers=false"
        ></iframe>
      </main>
      <script
        async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5572277246422121"
        crossorigin="anonymous"
      ></script>
      <!-- ad -->
      <ins
        class="adsbygoogle"
        style="display: block"
        data-ad-client="ca-pub-5572277246422121"
        data-ad-slot="5845016719"
        data-ad-format="auto"
        data-full-width-responsive="true"
      ></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      <!-- <main>
            <div class="table-container" style="margin-bottom:2rem;">
                <h2 style="text-align:left; font-size:1.15rem; margin:16px;">üì§ Share a Study Material</h2>
                <form id="resourceForm" class="resource-form">
                    <input type="text" id="resName" class="resource-input" maxlength="20" placeholder="Your Name" required>
                    <input type="text" id="resSemester" class="resource-input" maxlength="20" placeholder="Semester (e.g. Summer 2025)" required>
                    <input type="text" id="resCourse" class="resource-input" maxlength="120" placeholder="Material Details / Course" required>
                    <input type="url" id="resLink" class="resource-input" maxlength="300" placeholder="Resource Link (Google Drive, etc.)" required>
                    <button type="submit" class="resource-submit-btn">Share</button>
                </form>
                <!-- Preview Modal -->
      <!--
                <div id="previewModal" class="modal" style="display:none;">
                    <div style="background:#181926;padding:32px 24px 24px 24px;border-radius:14px;max-width:95vw;width:370px;box-shadow:0 8px 32px #0008;color:#e2e8f0;position:relative;overflow:auto;max-height:90vh;">
                        <h3 style="margin-top:0;margin-bottom:18px;font-size:1.15rem;">Confirm Submission</h3>
                        <div id="previewContent" style="font-size:1rem;line-height:1.7;margin-bottom:20px;word-break:break-all;max-width:100%;overflow-x:auto;"></div>
                        <div style="display:flex;gap:12px;justify-content:flex-end;">
                            <button id="cancelPreviewBtn" type="button" style="background:#22223b;color:#fff;border:none;padding:8px 18px;border-radius:7px;cursor:pointer;">Cancel</button>
                            <button id="confirmPreviewBtn" type="button" style="background:#a78bfa;color:#fff;border:none;padding:8px 18px;border-radius:7px;cursor:pointer;">Confirm & Upload</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="table-container" style="background:rgba(139,92,246,0.05);padding-bottom:24px;">
                <h2 style="text-align:left; font-size:1.1rem; margin:18px 18px 0 18px; color:#a78bfa;">üîó Shared Study Materials</h2>
                <div style="display:flex;align-items:center;gap:10px;margin:0 24px 10px 24px;">
                    <input type="text" id="resourceSearchInput" placeholder="Search study materials..." style="flex:1;background:#1a1c23;color:#e2e8f0;border:1.5px solid #334155;border-radius:8px;padding:9px 12px;font-size:1rem;">
                </div>
                <div id="resourceList"></div>
            </div>
        </main> -->
      <footer class="footer">
        <p>
          ¬© 2025 RDS2 BUT FROM FUTURE ¬∑ Created by Tahshan Jamil Shadhin
          <br />
        </p>
        <div class="social-links">
          <span>Follow me on</span>
          <a
            href="https://www.facebook.com/share/19DGPCk2wr/"
            target="_blank"
            title="Facebook"
          >
            <i class="fab fa-facebook"></i>
          </a>
          <a
            href="https://www.instagram.com/_shadhin_f"
            target="_blank"
            title="Instagram"
          >
            <i class="fab fa-instagram"></i>
          </a>
          <a
            href="https://www.linkedin.com/in/tahshan-jamil-shadhin?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app"
            target="_blank"
            title="LinkedIn"
          >
            <i class="fab fa-linkedin"></i>
          </a>
        </div>
        <br />
        Last updated: 16-05-2025 15:30
      </footer>
    </div>
    <script src="script.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-database-compat.js"></script>
    <script src="activeUsers.js"></script>
    <script>
      window.addEventListener("load", () => {
        initializeActiveUsers("resources");
      });
    </script>
    <script src="resources.js"></script>
    <script>
      // Preview modal logic for resource form
      const resourceForm = document.getElementById("resourceForm");
      const previewModal = document.getElementById("previewModal");
      const previewContent = document.getElementById("previewContent");
      const confirmBtn = document.getElementById("confirmPreviewBtn");
      const cancelBtn = document.getElementById("cancelPreviewBtn");

      // Store latest form data for confirmation
      let latestFormData = null;

      resourceForm.addEventListener("submit", function (e) {
        e.preventDefault();
        // Always read current form values (use .value, but also check for undefined/null)
        const nameInput = document.getElementById("resName");
        const semesterInput = document.getElementById("resSemester");
        const courseInput = document.getElementById("resCourse");
        const linkInput = document.getElementById("resLink");
        const name = nameInput ? nameInput.value : "";
        const semester = semesterInput ? semesterInput.value : "";
        const course = courseInput ? courseInput.value : "";
        const link = linkInput ? linkInput.value : "";

        latestFormData = { name, semester, course, link };

        // Defensive: clear error message if present
        const err = document.getElementById("modalErrorMsg");
        if (err) err.remove();

        // Build preview using divs for each field
        previewContent.innerHTML = "";
        function field(label, value, isLink) {
          const wrapper = document.createElement("div");
          wrapper.style.marginBottom = "10px";
          const labelDiv = document.createElement("div");
          labelDiv.style.fontWeight = "bold";
          labelDiv.style.color = "#a78bfa";
          labelDiv.textContent = label;
          const valueDiv = document.createElement("div");
          valueDiv.style.wordBreak = "break-all";
          valueDiv.style.color = "#e2e8f0";
          if (!value) {
            valueDiv.innerHTML = '<span style="color:#e11d48;">(empty)</span>';
          } else if (isLink) {
            const a = document.createElement("a");
            a.href = value;
            a.target = "_blank";
            a.style.color = "#a78bfa";
            a.textContent = value;
            valueDiv.appendChild(a);
          } else {
            valueDiv.textContent = value;
          }
          wrapper.appendChild(labelDiv);
          wrapper.appendChild(valueDiv);
          return wrapper;
        }
        previewContent.appendChild(field("Name", name));
        previewContent.appendChild(field("Semester", semester));
        previewContent.appendChild(field("Material Details / Course", course));
        previewContent.appendChild(field("Link", link, true));
        previewModal.style.display = "flex";
      });

      confirmBtn.addEventListener("click", function () {
        // Validate again before upload
        if (!latestFormData) return;
        // Use trim here for validation
        const name = latestFormData.name.trim();
        const semester = latestFormData.semester.trim();
        const course = latestFormData.course.trim();
        const link = latestFormData.link.trim();
        if (!name || !semester || !course || !link) {
          // Show error below the fields
          let err = document.getElementById("modalErrorMsg");
          if (!err) {
            err = document.createElement("div");
            err.id = "modalErrorMsg";
            err.style.color = "#e11d48";
            err.style.marginTop = "10px";
            previewContent.appendChild(err);
          }
          err.textContent = "All fields are required.";
          return;
        }
        // Push to Firebase directly
        if (window.firebase && window.firebase.database) {
          const db = firebase.database();
          const resourcesRef = db.ref("shared_resources");
          resourcesRef.push(
            {
              name,
              semester,
              course,
              link,
              upvotes: 0,
              downvotes: 0,
              reports: 0,
              timestamp: Date.now(),
            },
            function (error) {
              if (error) {
                alert("Resource upload failed.");
              }
            }
          );
        }
        // Reset form and modal
        resourceForm.reset();
        previewModal.style.display = "none";
        latestFormData = null;
        // Remove error message if present
        const err = document.getElementById("modalErrorMsg");
        if (err) err.remove();
      });

      cancelBtn.addEventListener("click", function () {
        previewModal.style.display = "none";
        latestFormData = null;
        // Remove error message if present
        const err = document.getElementById("modalErrorMsg");
        if (err) err.remove();
      });

      // Optional: Close modal on outside click
      previewModal.addEventListener("click", function (e) {
        if (e.target === previewModal) {
          previewModal.style.display = "none";
          latestFormData = null;
          // Remove error message if present
          const err = document.getElementById("modalErrorMsg");
          if (err) err.remove();
        }
      });
    </script>
  </body>
</html>
