<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5572277246422121"
      crossorigin="anonymous"
    ></script>
    <meta name="google-adsense-account" content="ca-pub-5572277246422121" />
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-DR0D2D6C35"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-DR0D2D6C35");
    </script>
    <link rel="icon" type="image/png" sizes="32x32" href="images/index.png" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NSU Retake Calculator</title>
    <link rel="stylesheet" href="styles.css?v=1.1" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      main {
        display: flex;
        flex-direction: column;
        gap: 2rem;
        padding-bottom: 2.5rem;
        max-width: 960px;
        margin: 0 auto;
        width: 100%;
      }
      .calculator-hero {
        text-align: center;
        margin-top: 1.5rem;
        margin-bottom: 0.5rem;
      }
      .calculator-hero h1 {
        font-size: clamp(2rem, 4vw, 2.6rem);
        margin-bottom: 0.5rem;
      }
      .calculator-hero p {
        color: var(--text-muted);
        max-width: 640px;
        margin: 0 auto 2rem;
        line-height: 1.5;
      }
      .calc-card {
        background: rgba(15, 23, 42, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 18px;
        padding: 1.75rem 1.5rem;
        box-shadow: 0 18px 40px rgba(0, 0, 0, 0.25);
        width: 100%;
      }
      .calc-card h2 {
        margin-top: 0;
        margin-bottom: 1rem;
        font-size: 1.2rem;
      }
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
      }
      .form-control,
      select.form-control {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.35);
        border-radius: 10px;
        color: #f8fafc;
        padding: 0.85rem 1rem;
        font-size: 1rem;
      }
      .form-control:focus,
      select.form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.25);
      }
      table.cgpa-table {
        width: 100%;
        min-width: 560px;
        border-collapse: collapse;
        table-layout: fixed;
      }
      table.cgpa-table th,
      table.cgpa-table td {
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        vertical-align: middle;
      }
      table.cgpa-table th {
        text-align: left;
        padding: 0.8rem 0.5rem;
        font-weight: 600;
        color: var(--text-muted);
        white-space: nowrap;
      }
      table.cgpa-table th:nth-child(1) {
        width: 26%;
      }
      table.cgpa-table th:nth-child(2) {
        width: 14%;
      }
      table.cgpa-table th:nth-child(3) {
        width: 20%;
      }
      table.cgpa-table th:nth-child(4) {
        width: 20%;
      }
      table.cgpa-table th:nth-child(5) {
        width: 20%;
      }
      table.cgpa-table td {
        padding: 0.6rem 0.5rem;
      }
      table.cgpa-table td .form-control,
      table.cgpa-table td select.form-control {
        width: 100%;
        min-width: 0;
      }
      .courses-wrapper {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      .courses-wrapper::-webkit-scrollbar {
        height: 6px;
      }
      .courses-wrapper::-webkit-scrollbar-thumb {
        background: rgba(148, 163, 184, 0.3);
        border-radius: 3px;
      }
      .actions-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1.75rem;
      }
      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.35rem;
        border-radius: 10px;
        border: 1px solid transparent;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        padding: 0.85rem 1.4rem;
      }
      .btn:hover {
        transform: translateY(-1px);
      }
      .btn-outline {
        background: transparent;
        border-color: #22c55e;
        color: #22c55e;
      }
      .btn-outline:hover {
        box-shadow: 0 0 12px rgba(34, 197, 94, 0.5);
      }
      .btn-primary {
        background: #22c55e;
        color: #0f172a;
      }
      .btn-primary:hover {
        box-shadow: 0 12px 32px rgba(34, 197, 94, 0.25);
      }
      .results-panel {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
        margin-top: 2rem;
        width: 100%;
      }
      .result-box {
        border-radius: 12px;
        padding: 1.2rem 1.6rem;
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.2);
      }
      .result-box.highlight {
        background: linear-gradient(135deg, #22c55e, #16a34a);
        color: #0f172a;
        border: none;
      }
      .result-box span {
        display: block;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        margin-bottom: 0.6rem;
        color: rgba(248, 250, 252, 0.8);
      }
      .result-box h3 {
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
      }
      .result-box.highlight span,
      .result-box.highlight h3 {
        color: #042f1a;
      }
      .result-box.highlight h3 {
        font-size: 2.4rem;
      }
      .calc-message {
        margin-top: 1rem;
        color: #fb7185;
        min-height: 1.2rem;
      }
      .remove-course {
        border: none;
        border-radius: 999px;
        width: 40px;
        height: 40px;
        background: rgba(248, 250, 252, 0.08);
        color: #f87171;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s ease, transform 0.2s ease;
      }
      .remove-course:hover {
        background: rgba(248, 113, 113, 0.15);
        transform: translateY(-1px);
      }
      .course-row:last-child td {
        border-bottom: none;
      }
      @media (max-width: 720px) {
        .calc-card {
          padding: 1rem 0.75rem;
        }
        .form-grid {
          grid-template-columns: 1fr;
        }
        .actions-row {
          flex-direction: column;
          align-items: stretch;
        }
        .btn {
          width: 100%;
        }
        .results-panel {
          grid-template-columns: 1fr;
        }
        .stats-grid {
          grid-template-columns: 1fr !important;
        }
      }

      /* Stats Grid Styling */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }

      .stat-card {
        background: rgba(15, 23, 42, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
        transition: transform 0.2s ease, border-color 0.2s ease;
      }

      .stat-card:hover {
        transform: translateY(-2px);
        border-color: var(--primary-color);
      }

      .stat-card.reached {
        background: linear-gradient(135deg, #22c55e, #16a34a);
        border: none;
      }

      .stat-card .target-label {
        display: block;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        margin-bottom: 0.4rem;
        color: var(--text-muted);
      }

      .stat-card.reached .target-label {
        color: rgba(4, 47, 26, 0.8);
      }

      .stat-card .target-cgpa {
        display: block;
        font-size: 1.6rem;
        font-weight: 700;
        margin-bottom: 0.6rem;
        color: var(--text-color);
      }

      .stat-card.reached .target-cgpa {
        color: #042f1a;
      }

      .stat-card .retake-count {
        font-size: 1rem;
        color: var(--primary-color);
        font-weight: 600;
      }

      .stat-card.reached .retake-count {
        color: #042f1a;
        font-size: 1.1rem;
      }

      .scenario-section {
        margin-top: 0.75rem;
        padding-top: 0.75rem;
        border-top: 1px solid rgba(148, 163, 184, 0.15);
        font-size: 0.8rem;
        text-align: left;
      }

      .scenario-item {
        margin-bottom: 0.5rem;
        padding: 0.4rem;
        background: rgba(15, 23, 42, 0.5);
        border-radius: 6px;
      }

      .scenario-item:last-child {
        margin-bottom: 0;
      }

      .scenario-title {
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 0.2rem;
        font-size: 0.8rem;
      }

      .scenario-details {
        color: var(--text-muted);
        font-size: 0.75rem;
        line-height: 1.4;
      }

      .scenario-details strong {
        color: var(--text-color);
      }
    </style>
  </head>
  <body>
    <canvas id="particleCanvas"></canvas>
    <div class="container">
      <header>
        <h1>NSU Retake Calculator</h1>
        <nav class="nav-bar">
          <a href="index.html">RDS2</a>
          <a href="calendar.html">Academic Calendar</a>
          <a href="resources.html" class="trending-link">Study Materials</a>
          <a href="routine.html">Routine Maker</a>
          <a href="planner.html">Semester Planner</a>
          <a href="freshman.html">Freshman Guides</a>
          <a href="coursemap.html">Course map</a>
          <a href="booksearch.html">NSU Library Book Locator</a>
          <a href="shelf_search.html">Library Shelf Finder</a>
          <a href="cgpa.html">CGPA Calculator</a>
          <a href="retake.html" class="active">Retake Calculator</a>
          <a href="gradeCalculator.html">Course Grade Calculator</a>
          <a href="about.html">About Dev</a>
        </nav>
      </header>

      <main>
        <div class="announcement-bar">
          <span>ðŸŽ“ Join telegram group to stay updated</span>
          <a
            href="https://t.me/nsu_advising_helper_bot_channel"
            target="_blank"
            class="view-extension-btn"
            >âš¡ Join now</a
          >
        </div>
        <section class="calculator-hero">
          <p>
            Plan your retakes smartly. Enter your current credits &amp; CGPA,
            then add the courses you plan to retake with previous and expected
            grades. See how your CGPA will change after the retakes.
          </p>
        </section>

        <section class="calc-card">
          <h2>Current Summary</h2>
          <div class="form-grid">
            <div>
              <label for="prevCr">Credits Completed</label>
              <input
                type="number"
                min="0"
                step="0.5"
                id="prevCr"
                class="form-control"
                placeholder="e.g., 90"
              />
            </div>
            <div>
              <label for="prevCg">Current CGPA</label>
              <input
                type="number"
                min="0"
                max="4"
                step="0.01"
                id="prevCg"
                class="form-control"
                placeholder="e.g., 2.85"
              />
            </div>
          </div>
        </section>

        <section class="calc-card">
          <h2>Retake Courses</h2>
          <div class="courses-wrapper">
            <table class="cgpa-table">
              <thead>
                <tr>
                  <th>Course (opt)</th>
                  <th>Credits</th>
                  <th>Prev Grade</th>
                  <th>Expected</th>
                  <th style="width: 60px">Remove</th>
                </tr>
              </thead>
              <tbody id="courseRows"></tbody>
            </table>
          </div>
          <div class="actions-row">
            <button id="addCourse" class="btn btn-outline">
              <i class="fas fa-plus"></i> Add Retake
            </button>
            <div style="flex: 1"></div>
            <button id="calculateBtn" class="btn btn-primary">
              <i class="fas fa-calculator"></i> Calculate
            </button>
          </div>
          <div id="calcMessage" class="calc-message"></div>
        </section>

        <div class="results-panel">
          <div class="result-box">
            <span>Credits (unchanged)</span>
            <h3 id="creditDisplay">0.00</h3>
          </div>
          <div class="result-box highlight">
            <span>Projected CGPA</span>
            <h3 id="cgpaValue">0.00</h3>
          </div>
        </div>

        <!-- Target CGPA Calculator Section -->
        <section class="calc-card" style="margin-top: 2rem">
          <h2>Target CGPA Calculator</h2>
          <p
            style="
              color: var(--text-muted);
              margin-bottom: 1.5rem;
              font-size: 0.95rem;
            "
          >
            Set your target CGPA to see how many 3-credit courses with A grade
            you need to retake to reach it.
          </p>
          <div class="form-grid">
            <div>
              <label for="targetCredits">Current Credits Completed</label>
              <input
                type="number"
                min="0"
                step="0.5"
                id="targetCredits"
                class="form-control"
                placeholder="e.g., 90"
              />
            </div>
            <div>
              <label for="targetCurrentCgpa">Current CGPA</label>
              <input
                type="number"
                min="0"
                max="4"
                step="0.01"
                id="targetCurrentCgpa"
                class="form-control"
                placeholder="e.g., 2.85"
              />
            </div>
            <div>
              <label for="targetCgpa">Target CGPA</label>
              <input
                type="number"
                min="0"
                max="4"
                step="0.01"
                id="targetCgpa"
                class="form-control"
                placeholder="e.g., 3.50"
              />
            </div>
          </div>
          <div class="actions-row" style="justify-content: center">
            <button id="calculateTargetBtn" class="btn btn-primary">
              <i class="fas fa-bullseye"></i> Calculate Required Retakes
            </button>
          </div>
          <div
            id="targetResult"
            style="
              margin-top: 1.5rem;
              padding: 1.2rem;
              background: rgba(109, 40, 217, 0.1);
              border-radius: 12px;
              border: 1px solid rgba(109, 40, 217, 0.3);
              display: none;
            "
          >
            <div
              style="
                text-align: center;
                font-size: 1.1rem;
                color: var(--text-color);
                margin-bottom: 1rem;
              "
            >
              <strong id="targetResultText"></strong>
            </div>
            <div id="targetScenarios" style="display: none">
              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 1rem;
                "
              >
                <div class="scenario-item">
                  <div class="scenario-title">B- â†’ A Scenario</div>
                  <div class="scenario-details" id="targetScenarioBMinus"></div>
                </div>
                <div class="scenario-item">
                  <div class="scenario-title">C â†’ A Scenario</div>
                  <div class="scenario-details" id="targetScenarioC"></div>
                </div>
                <div class="scenario-item">
                  <div class="scenario-title">D â†’ A Scenario</div>
                  <div class="scenario-details" id="targetScenarioD"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Statistics Section moved here -->
          <div id="statsSection" style="margin-top: 2rem; display: none">
            <h3
              style="
                font-size: 1.1rem;
                margin-bottom: 1rem;
                color: var(--text-color);
              "
            >
              All Target CGPAs - Retake Breakdown
            </h3>
            <p
              style="
                color: var(--text-muted);
                margin-bottom: 1rem;
                font-size: 0.9rem;
              "
            >
              Based on your current summary, here's how many 3-credit courses
              with A grade you need to retake to reach different CGPA targets.
            </p>
            <div class="stats-grid" id="statsGrid"></div>
          </div>
        </section>

        <!-- Graduation Planning Section -->
        <section class="calc-card" style="margin-top: 2rem">
          <h2>Graduation Planning Calculator</h2>
          <p
            style="
              color: var(--text-muted);
              margin-bottom: 1.5rem;
              font-size: 0.95rem;
            "
          >
            Check if you can graduate with your target CGPA, or if you need
            retakes before completing your degree.
          </p>
          <div class="form-grid">
            <div>
              <label for="gradCurrentCredits">Current Credits Completed</label>
              <input
                type="number"
                min="0"
                step="0.5"
                id="gradCurrentCredits"
                class="form-control"
                placeholder="e.g., 90"
              />
            </div>
            <div>
              <label for="gradCurrentCgpa">Current CGPA</label>
              <input
                type="number"
                min="0"
                max="4"
                step="0.01"
                id="gradCurrentCgpa"
                class="form-control"
                placeholder="e.g., 2.85"
              />
            </div>
            <div>
              <label for="gradTargetCgpa">Target CGPA</label>
              <input
                type="number"
                min="0"
                max="4"
                step="0.01"
                id="gradTargetCgpa"
                class="form-control"
                placeholder="e.g., 3.50"
              />
            </div>
            <div>
              <label for="gradTotalCredits">Total Department Credits</label>
              <input
                type="number"
                min="0"
                step="0.5"
                id="gradTotalCredits"
                class="form-control"
                placeholder="e.g., 126"
              />
            </div>
          </div>
          <div class="actions-row" style="justify-content: center">
            <button id="calculateGradBtn" class="btn btn-primary">
              <i class="fas fa-graduation-cap"></i> Check Graduation Plan
            </button>
          </div>
          <div
            id="gradResult"
            style="
              margin-top: 1.5rem;
              padding: 1.2rem;
              background: rgba(109, 40, 217, 0.1);
              border-radius: 12px;
              border: 1px solid rgba(109, 40, 217, 0.3);
              display: none;
            "
          >
            <div
              style="
                text-align: center;
                font-size: 1.1rem;
                color: var(--text-color);
                margin-bottom: 1rem;
              "
            >
              <strong id="gradResultText"></strong>
            </div>
            <div id="gradScenarios" style="display: none">
              <div
                style="
                  display: grid;
                  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                  gap: 1rem;
                "
              >
                <div class="scenario-item">
                  <div class="scenario-title">B- â†’ A Scenario</div>
                  <div class="scenario-details" id="gradScenarioBMinus"></div>
                </div>
                <div class="scenario-item">
                  <div class="scenario-title">C â†’ A Scenario</div>
                  <div class="scenario-details" id="gradScenarioC"></div>
                </div>
                <div class="scenario-item">
                  <div class="scenario-title">D â†’ A Scenario</div>
                  <div class="scenario-details" id="gradScenarioD"></div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>

      <footer class="footer">
        <p>
          Â© 2025 RDS2 BUT FROM FUTURE Â· Created by Tahshan Jamil Shadhin
          <br />
        </p>
        <div class="social-links">
          <span>Follow me on</span>
          <a
            href="https://www.facebook.com/share/19DGPCk2wr/"
            target="_blank"
            title="Facebook"
          >
            <i class="fab fa-facebook"></i>
          </a>
          <a
            href="https://www.instagram.com/_shadhin_f"
            target="_blank"
            title="Instagram"
          >
            <i class="fab fa-instagram"></i>
          </a>
          <a
            href="https://www.linkedin.com/in/tahshan-jamil-shadhin?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app"
            target="_blank"
            title="LinkedIn"
          >
            <i class="fab fa-linkedin"></i>
          </a>
        </div>
        <br />
        Last updated: 04-01-2026
      </footer>
    </div>

    <script>
      const gradePoints = {
        A: 4.0,
        "A-": 3.7,
        "B+": 3.3,
        B: 3.0,
        "B-": 2.7,
        "C+": 2.3,
        C: 2.0,
        "C-": 1.7,
        "D+": 1.3,
        D: 1.0,
        F: 0,
      };

      const courseRows = document.getElementById("courseRows");
      const addCourseBtn = document.getElementById("addCourse");
      const calcBtn = document.getElementById("calculateBtn");
      const creditDisplayEl = document.getElementById("creditDisplay");
      const cgpaValueEl = document.getElementById("cgpaValue");
      const messageEl = document.getElementById("calcMessage");

      let rowCount = 0;

      function createSelect(id, defaultGrade) {
        const select = document.createElement("select");
        select.id = id;
        select.className = "form-control";
        for (const grade of Object.keys(gradePoints)) {
          const option = document.createElement("option");
          option.value = grade;
          option.textContent = grade;
          if (grade === defaultGrade) option.selected = true;
          select.appendChild(option);
        }
        return select;
      }

      function addRetakeRow() {
        rowCount += 1;
        const row = document.createElement("tr");
        row.className = "course-row";
        row.dataset.index = rowCount;
        const creditId = `cr${rowCount}`;
        const prevGradeId = `prevGr${rowCount}`;
        const expGradeId = `expGr${rowCount}`;

        row.innerHTML = `
          <td>
            <input
              type="text"
              class="form-control"
              placeholder="Course"
              maxlength="10"
            />
          </td>
          <td>
            <input
              type="number"
              min="0"
              step="0.5"
              class="form-control"
              id="${creditId}"
              placeholder="Cr"
            />
          </td>
          <td id="${prevGradeId}-cell"></td>
          <td id="${expGradeId}-cell"></td>
          <td class="remove-cell">
            <button type="button" class="remove-course" aria-label="Remove">
              <i class="fas fa-xmark"></i>
            </button>
          </td>
        `;

        courseRows.appendChild(row);
        document
          .getElementById(`${prevGradeId}-cell`)
          .appendChild(createSelect(prevGradeId, "F"));
        document
          .getElementById(`${expGradeId}-cell`)
          .appendChild(createSelect(expGradeId, "A"));
        row.querySelector(".remove-course").addEventListener("click", () => {
          removeRow(row);
        });
      }

      function removeRow(row) {
        if (courseRows.children.length <= 1) {
          messageEl.textContent = "At least one retake row is required.";
          return;
        }
        row.remove();
        messageEl.textContent = "Removed retake row.";
      }

      function initializeRows() {
        addRetakeRow();
      }

      function calculate() {
        const prevCredits =
          Number(document.getElementById("prevCr").value) || 0;
        const prevCgpa = Number(document.getElementById("prevCg").value) || 0;

        if (!prevCredits || !prevCgpa) {
          messageEl.textContent = "Please enter your current credits and CGPA.";
          creditDisplayEl.textContent = "0.00";
          cgpaValueEl.textContent = "0.00";
          document.getElementById("statsSection").style.display = "none";
          return;
        }

        let totalQualityPoints = prevCredits * prevCgpa;
        let totalCredits = prevCredits;
        let hasRetake = false;

        for (let i = 1; i <= rowCount; i += 1) {
          const creditInput = document.getElementById(`cr${i}`);
          const prevGradeSelect = document.getElementById(`prevGr${i}`);
          const expGradeSelect = document.getElementById(`expGr${i}`);
          if (!creditInput || !prevGradeSelect || !expGradeSelect) continue;

          const credits = Number(creditInput.value);
          if (!credits) continue;
          hasRetake = true;

          const prevPoint = gradePoints[prevGradeSelect.value] ?? 0;
          const expPoint = gradePoints[expGradeSelect.value] ?? 0;

          // Remove old contribution, add new
          totalQualityPoints -= credits * prevPoint;
          totalQualityPoints += credits * expPoint;
        }

        if (!hasRetake) {
          messageEl.textContent =
            "Add at least one retake course with credits.";
          creditDisplayEl.textContent = prevCredits.toFixed(2);
          cgpaValueEl.textContent = prevCgpa.toFixed(2);
          document.getElementById("statsSection").style.display = "none";
          return;
        }

        const newCgpa = totalQualityPoints / totalCredits;
        messageEl.textContent = "Projected CGPA calculated successfully.";
        creditDisplayEl.textContent = totalCredits.toFixed(2);
        cgpaValueEl.textContent = newCgpa.toFixed(2);

        // Generate statistics
        generateStatistics(prevCredits, prevCgpa);
      }

      function calculateRetakesNeeded(currentCredits, currentCgpa, targetCgpa) {
        // Formula: To reach target CGPA by retaking courses with grade A (4.0)
        // Each 3-credit retake replaces F (0.0) with A (4.0), adding 12 quality points
        // New CGPA = (current quality points + added quality points) / total credits
        // Target = (currentCredits * currentCgpa + n * 3 * 4.0) / currentCredits
        // Solving for n: n = (currentCredits * (targetCgpa - currentCgpa)) / 12

        if (currentCgpa >= targetCgpa) {
          return 0; // Already reached
        }

        const currentQualityPoints = currentCredits * currentCgpa;
        const neededQualityPoints = currentCredits * targetCgpa;
        const qualityPointsPerRetake = 3 * 4.0; // 3 credits * 4.0 (A grade)

        const retakesNeeded = Math.ceil(
          (neededQualityPoints - currentQualityPoints) / qualityPointsPerRetake
        );
        return retakesNeeded;
      }

      function calculateRetakesForScenario(
        currentCredits,
        currentCgpa,
        targetCgpa,
        fromGrade
      ) {
        // fromGrade: the grade being replaced (B-, C, D)
        // toGrade: A (4.0)
        if (currentCgpa >= targetCgpa) {
          return 0;
        }

        const fromPoint = gradePoints[fromGrade] ?? 0;
        const toPoint = 4.0; // A grade
        const qualityPointsGain = (toPoint - fromPoint) * 3; // per 3-credit course

        const currentQualityPoints = currentCredits * currentCgpa;
        const neededQualityPoints = currentCredits * targetCgpa;
        const requiredGain = neededQualityPoints - currentQualityPoints;

        const retakesNeeded = Math.ceil(requiredGain / qualityPointsGain);
        return retakesNeeded;
      }

      function generateStatistics(currentCredits, currentCgpa) {
        const targets = [4.0, 3.8, 3.7, 3.5, 3.3, 3.0, 2.8, 2.5, 2.0];
        const statsGrid = document.getElementById("statsGrid");
        statsGrid.innerHTML = "";

        targets.forEach((target) => {
          const isReached = currentCgpa >= target;

          const card = document.createElement("div");
          card.className = isReached ? "stat-card reached" : "stat-card";

          if (isReached) {
            card.innerHTML = `
              <span class="target-label">Target CGPA</span>
              <span class="target-cgpa">${target.toFixed(1)}</span>
              <span class="retake-count">âœ“ Reached</span>
            `;
          } else {
            // Calculate for three scenarios
            const retakesBMinus = calculateRetakesForScenario(
              currentCredits,
              currentCgpa,
              target,
              "B-"
            );
            const retakesC = calculateRetakesForScenario(
              currentCredits,
              currentCgpa,
              target,
              "C"
            );
            const retakesD = calculateRetakesForScenario(
              currentCredits,
              currentCgpa,
              target,
              "D"
            );

            const creditsBMinus = retakesBMinus * 3;
            const creditsC = retakesC * 3;
            const creditsD = retakesD * 3;

            const costBMinus6500 = creditsBMinus * 6500;
            const costBMinus8000 = creditsBMinus * 8000;
            const costC6500 = creditsC * 6500;
            const costC8000 = creditsC * 8000;
            const costD6500 = creditsD * 6500;
            const costD8000 = creditsD * 8000;

            card.innerHTML = `
              <span class="target-label">Target CGPA</span>
              <span class="target-cgpa">${target.toFixed(1)}</span>
              <div class="scenario-section">
                <div class="scenario-item">
                  <div class="scenario-title">B- â†’ A Scenario</div>
                  <div class="scenario-details">
                    <strong>${retakesBMinus}</strong> retakes (${creditsBMinus} cr)<br>
                    à§³${costBMinus6500.toLocaleString()} / à§³${costBMinus8000.toLocaleString()}
                  </div>
                </div>
                <div class="scenario-item">
                  <div class="scenario-title">C â†’ A Scenario</div>
                  <div class="scenario-details">
                    <strong>${retakesC}</strong> retakes (${creditsC} cr)<br>
                    à§³${costC6500.toLocaleString()} / à§³${costC8000.toLocaleString()}
                  </div>
                </div>
                <div class="scenario-item">
                  <div class="scenario-title">D â†’ A Scenario</div>
                  <div class="scenario-details">
                    <strong>${retakesD}</strong> retakes (${creditsD} cr)<br>
                    à§³${costD6500.toLocaleString()} / à§³${costD8000.toLocaleString()}
                  </div>
                </div>
              </div>
            `;
          }

          statsGrid.appendChild(card);
        });

        document.getElementById("statsSection").style.display = "block";
      }

      function calculateTargetRetakes() {
        const targetCredits =
          Number(document.getElementById("targetCredits").value) || 0;
        const targetCurrentCgpa =
          Number(document.getElementById("targetCurrentCgpa").value) || 0;
        const targetCgpa =
          Number(document.getElementById("targetCgpa").value) || 0;
        const targetResultDiv = document.getElementById("targetResult");
        const targetResultText = document.getElementById("targetResultText");
        const targetScenariosDiv = document.getElementById("targetScenarios");

        if (!targetCredits || !targetCurrentCgpa || !targetCgpa) {
          targetResultText.textContent = "Please fill in all fields.";
          targetResultDiv.style.background = "rgba(251, 113, 133, 0.1)";
          targetResultDiv.style.borderColor = "rgba(251, 113, 133, 0.3)";
          targetResultDiv.style.display = "block";
          targetScenariosDiv.style.display = "none";
          document.getElementById("statsSection").style.display = "none";
          return;
        }

        if (targetCgpa > 4.0 || targetCgpa < 0) {
          targetResultText.textContent =
            "Target CGPA must be between 0 and 4.0";
          targetResultDiv.style.background = "rgba(251, 113, 133, 0.1)";
          targetResultDiv.style.borderColor = "rgba(251, 113, 133, 0.3)";
          targetResultDiv.style.display = "block";
          targetScenariosDiv.style.display = "none";
          document.getElementById("statsSection").style.display = "none";
          return;
        }

        if (targetCurrentCgpa >= targetCgpa) {
          targetResultText.innerHTML = `ðŸŽ‰ You have already reached your target CGPA of <strong>${targetCgpa.toFixed(
            2
          )}</strong>!`;
          targetResultDiv.style.background =
            "linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(22, 163, 74, 0.15))";
          targetResultDiv.style.borderColor = "rgba(34, 197, 94, 0.4)";
          targetResultDiv.style.display = "block";
          targetScenariosDiv.style.display = "none";
          document.getElementById("statsSection").style.display = "none";
          return;
        }

        // Calculate for three scenarios
        const retakesBMinus = calculateRetakesForScenario(
          targetCredits,
          targetCurrentCgpa,
          targetCgpa,
          "B-"
        );
        const retakesC = calculateRetakesForScenario(
          targetCredits,
          targetCurrentCgpa,
          targetCgpa,
          "C"
        );
        const retakesD = calculateRetakesForScenario(
          targetCredits,
          targetCurrentCgpa,
          targetCgpa,
          "D"
        );

        const creditsBMinus = retakesBMinus * 3;
        const creditsC = retakesC * 3;
        const creditsD = retakesD * 3;

        const costBMinus6500 = creditsBMinus * 6500;
        const costBMinus8000 = creditsBMinus * 8000;
        const costC6500 = creditsC * 6500;
        const costC8000 = creditsC * 8000;
        const costD6500 = creditsD * 6500;
        const costD8000 = creditsD * 8000;

        targetResultText.innerHTML = `ðŸ“š To reach a CGPA of <strong>${targetCgpa.toFixed(
          2
        )}</strong>, you need:`;
        targetResultDiv.style.background = "rgba(109, 40, 217, 0.1)";
        targetResultDiv.style.borderColor = "rgba(109, 40, 217, 0.3)";

        document.getElementById("targetScenarioBMinus").innerHTML = `
          <strong>${retakesBMinus}</strong> retakes (${creditsBMinus} cr)<br>
          à§³${costBMinus6500.toLocaleString()} / à§³${costBMinus8000.toLocaleString()}
        `;
        document.getElementById("targetScenarioC").innerHTML = `
          <strong>${retakesC}</strong> retakes (${creditsC} cr)<br>
          à§³${costC6500.toLocaleString()} / à§³${costC8000.toLocaleString()}
        `;
        document.getElementById("targetScenarioD").innerHTML = `
          <strong>${retakesD}</strong> retakes (${creditsD} cr)<br>
          à§³${costD6500.toLocaleString()} / à§³${costD8000.toLocaleString()}
        `;

        targetScenariosDiv.style.display = "block";
        targetResultDiv.style.display = "block";

        // Generate statistics for all targets
        generateStatistics(targetCredits, targetCurrentCgpa);
      }

      function calculateGraduation() {
        const currentCredits =
          Number(document.getElementById("gradCurrentCredits").value) || 0;
        const currentCgpa =
          Number(document.getElementById("gradCurrentCgpa").value) || 0;
        const targetCgpa =
          Number(document.getElementById("gradTargetCgpa").value) || 0;
        const totalCredits =
          Number(document.getElementById("gradTotalCredits").value) || 0;

        const gradResultDiv = document.getElementById("gradResult");
        const gradResultText = document.getElementById("gradResultText");
        const gradScenariosDiv = document.getElementById("gradScenarios");

        // Validation
        if (!currentCredits || !currentCgpa || !targetCgpa || !totalCredits) {
          gradResultText.textContent = "Please fill in all fields.";
          gradResultDiv.style.background = "rgba(251, 113, 133, 0.1)";
          gradResultDiv.style.borderColor = "rgba(251, 113, 133, 0.3)";
          gradResultDiv.style.display = "block";
          gradScenariosDiv.style.display = "none";
          return;
        }

        if (currentCredits >= totalCredits) {
          gradResultText.textContent =
            "You have already completed all credits. Consider using the Target CGPA Calculator for retakes.";
          gradResultDiv.style.background = "rgba(251, 191, 36, 0.1)";
          gradResultDiv.style.borderColor = "rgba(251, 191, 36, 0.3)";
          gradResultDiv.style.display = "block";
          gradScenariosDiv.style.display = "none";
          return;
        }

        const remainingCredits = totalCredits - currentCredits;
        const currentQualityPoints = currentCredits * currentCgpa;

        // Best case: All remaining courses with A (4.0)
        const bestPossibleQP = currentQualityPoints + remainingCredits * 4.0;
        const bestPossibleCGPA = bestPossibleQP / totalCredits;

        if (currentCgpa >= targetCgpa) {
          // Even if current CGPA meets target, need to maintain it through remaining courses
          const neededQP = totalCredits * targetCgpa;
          const additionalQPNeeded = neededQP - currentQualityPoints;
          const avgGradeNeeded = additionalQPNeeded / remainingCredits;

          // If avgGradeNeeded is negative or very low, they have buffer room
          if (avgGradeNeeded <= 0) {
            const maxDropQP = currentQualityPoints - totalCredits * targetCgpa;
            const minAvgGrade =
              (currentQualityPoints - maxDropQP) / totalCredits;

            gradResultText.innerHTML = `ðŸŽ‰ You have already reached your target CGPA of <strong>${targetCgpa.toFixed(
              2
            )}</strong>!<br>
              You can graduate by completing the remaining <strong>${remainingCredits}</strong> credits with any passing grades (even all D's will keep you at <strong>${targetCgpa.toFixed(
              2
            )}</strong>).`;
            gradResultDiv.style.background =
              "linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(22, 163, 74, 0.15))";
            gradResultDiv.style.borderColor = "rgba(34, 197, 94, 0.4)";
            gradResultDiv.style.display = "block";
            gradScenariosDiv.style.display = "none";
            return;
          }

          // Need to maintain certain grades to keep the target CGPA
          let gradeText = "";
          if (avgGradeNeeded >= 4.0) {
            gradeText = "all A grades";
          } else if (avgGradeNeeded >= 3.7) {
            gradeText = "mostly A and A-";
          } else if (avgGradeNeeded >= 3.3) {
            gradeText = "mostly A- and B+";
          } else if (avgGradeNeeded >= 3.0) {
            gradeText = "mostly B+ and B";
          } else if (avgGradeNeeded >= 2.7) {
            gradeText = "mostly B and B-";
          } else if (avgGradeNeeded >= 2.3) {
            gradeText = "mostly B- and C+";
          } else if (avgGradeNeeded >= 2.0) {
            gradeText = "at least C average";
          } else if (avgGradeNeeded >= 1.7) {
            gradeText = "at least C- average";
          } else {
            gradeText = "at least D+ average";
          }

          // Calculate how many courses of each grade needed
          const coursesNeeded = Math.ceil(remainingCredits / 3);

          const aNeeded = Math.ceil(additionalQPNeeded / (4.0 * 3));
          const bPlusNeeded = Math.ceil(additionalQPNeeded / (3.3 * 3));
          const bNeeded = Math.ceil(additionalQPNeeded / (3.0 * 3));
          const bMinusNeeded = Math.ceil(additionalQPNeeded / (2.7 * 3));

          let gradeBreakdown = "";
          if (avgGradeNeeded >= 0.1) {
            gradeBreakdown = `<div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(148, 163, 184, 0.2);">
              <div style="font-size: 0.95rem; color: var(--text-muted); margin-bottom: 0.75rem;">
                <strong>Minimum Grade Requirements (3-credit courses):</strong>
              </div>
              <div style="display: grid; gap: 0.5rem; font-size: 0.9rem;">`;

            if (aNeeded <= coursesNeeded && aNeeded > 0) {
              const remaining = coursesNeeded - aNeeded;
              gradeBreakdown += `<div>â€¢ <strong>${aNeeded}</strong> A's${
                remaining > 0 ? ` + ${remaining} course(s) with any grade` : ""
              }</div>`;
            }
            if (bPlusNeeded <= coursesNeeded && bPlusNeeded > 0) {
              const remaining = coursesNeeded - bPlusNeeded;
              gradeBreakdown += `<div>â€¢ <strong>${bPlusNeeded}</strong> B+'s${
                remaining > 0 ? ` + ${remaining} course(s) with any grade` : ""
              }</div>`;
            }
            if (bNeeded <= coursesNeeded && bNeeded > 0) {
              const remaining = coursesNeeded - bNeeded;
              gradeBreakdown += `<div>â€¢ <strong>${bNeeded}</strong> B's${
                remaining > 0 ? ` + ${remaining} course(s) with any grade` : ""
              }</div>`;
            }
            if (bMinusNeeded <= coursesNeeded && bMinusNeeded > 0) {
              const remaining = coursesNeeded - bMinusNeeded;
              gradeBreakdown += `<div>â€¢ <strong>${bMinusNeeded}</strong> B-'s${
                remaining > 0 ? ` + ${remaining} course(s) with any grade` : ""
              }</div>`;
            }

            gradeBreakdown += `</div></div>`;
          }

          gradResultText.innerHTML = `âœ… Current CGPA: <strong>${currentCgpa.toFixed(
            2
          )}</strong> (Target: <strong>${targetCgpa.toFixed(2)}</strong>)<br>
            To <strong>maintain</strong> your target CGPA, complete the remaining <strong>${remainingCredits}</strong> credits with an average of at least <strong>${avgGradeNeeded.toFixed(
            2
          )}</strong> (${gradeText}).${gradeBreakdown}`;
          gradResultDiv.style.background =
            "linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(22, 163, 74, 0.15))";
          gradResultDiv.style.borderColor = "rgba(34, 197, 94, 0.4)";
          gradResultDiv.style.display = "block";
          gradScenariosDiv.style.display = "none";
          return;
        }

        if (bestPossibleCGPA < targetCgpa) {
          // Cannot reach target even with all A's - need retakes
          gradResultText.innerHTML = `âš ï¸ Cannot reach target CGPA of <strong>${targetCgpa.toFixed(
            2
          )}</strong> even with all A's in remaining courses.<br>
            Best possible: <strong>${bestPossibleCGPA.toFixed(2)}</strong><br>
            <strong>Retakes are required:</strong>`;
          gradResultDiv.style.background = "rgba(251, 191, 36, 0.1)";
          gradResultDiv.style.borderColor = "rgba(251, 191, 36, 0.3)";

          // Calculate retakes needed for three scenarios
          const retakesBMinus = calculateRetakesForScenario(
            currentCredits,
            currentCgpa,
            targetCgpa,
            "B-"
          );
          const retakesC = calculateRetakesForScenario(
            currentCredits,
            currentCgpa,
            targetCgpa,
            "C"
          );
          const retakesD = calculateRetakesForScenario(
            currentCredits,
            currentCgpa,
            targetCgpa,
            "D"
          );

          const creditsBMinus = retakesBMinus * 3;
          const creditsC = retakesC * 3;
          const creditsD = retakesD * 3;

          const costBMinus6500 = creditsBMinus * 6500;
          const costBMinus8000 = creditsBMinus * 8000;
          const costC6500 = creditsC * 6500;
          const costC8000 = creditsC * 8000;
          const costD6500 = creditsD * 6500;
          const costD8000 = creditsD * 8000;

          document.getElementById("gradScenarioBMinus").innerHTML = `
            <strong>${retakesBMinus}</strong> retakes (${creditsBMinus} cr)<br>
            à§³${costBMinus6500.toLocaleString()} / à§³${costBMinus8000.toLocaleString()}
          `;
          document.getElementById("gradScenarioC").innerHTML = `
            <strong>${retakesC}</strong> retakes (${creditsC} cr)<br>
            à§³${costC6500.toLocaleString()} / à§³${costC8000.toLocaleString()}
          `;
          document.getElementById("gradScenarioD").innerHTML = `
            <strong>${retakesD}</strong> retakes (${creditsD} cr)<br>
            à§³${costD6500.toLocaleString()} / à§³${costD8000.toLocaleString()}
          `;

          gradScenariosDiv.style.display = "block";
        } else {
          // Can reach target without retakes
          const neededQP = totalCredits * targetCgpa;
          const additionalQPNeeded = neededQP - currentQualityPoints;
          const avgGradeNeeded = additionalQPNeeded / remainingCredits;

          let gradeText = "";
          if (avgGradeNeeded <= 0) {
            gradeText = "any passing grades";
          } else if (avgGradeNeeded >= 4.0) {
            gradeText = "all A grades";
          } else if (avgGradeNeeded >= 3.7) {
            gradeText = "mostly A and A-";
          } else if (avgGradeNeeded >= 3.3) {
            gradeText = "mostly A- and B+";
          } else if (avgGradeNeeded >= 3.0) {
            gradeText = "mostly B+ and B";
          } else if (avgGradeNeeded >= 2.7) {
            gradeText = "mostly B and B-";
          } else if (avgGradeNeeded >= 2.3) {
            gradeText = "mostly B- and C+";
          } else {
            gradeText = "at least C average";
          }

          // Calculate how many courses of each grade needed (assuming 3-credit courses)
          const coursesNeeded = Math.ceil(remainingCredits / 3);

          // Calculate different combinations
          const aNeeded = Math.ceil(additionalQPNeeded / (4.0 * 3)); // All A's
          const bPlusNeeded = Math.ceil(additionalQPNeeded / (3.3 * 3)); // All B+'s
          const bNeeded = Math.ceil(additionalQPNeeded / (3.0 * 3)); // All B's
          const bMinusNeeded = Math.ceil(additionalQPNeeded / (2.7 * 3)); // All B-'s

          let gradeBreakdown = "";
          if (avgGradeNeeded >= 0.1) {
            gradeBreakdown = `<div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(148, 163, 184, 0.2);">
              <div style="font-size: 0.95rem; color: var(--text-muted); margin-bottom: 0.75rem;">
                <strong>Grade Requirements (assuming 3-credit courses):</strong>
              </div>
              <div style="display: grid; gap: 0.5rem; font-size: 0.9rem;">`;

            if (aNeeded <= coursesNeeded && aNeeded > 0) {
              const remaining = coursesNeeded - aNeeded;
              gradeBreakdown += `<div>â€¢ <strong>${aNeeded}</strong> A's${
                remaining > 0 ? ` + ${remaining} course(s) with any grade` : ""
              }</div>`;
            }
            if (bPlusNeeded <= coursesNeeded && bPlusNeeded > 0) {
              const remaining = coursesNeeded - bPlusNeeded;
              gradeBreakdown += `<div>â€¢ <strong>${bPlusNeeded}</strong> B+'s${
                remaining > 0 ? ` + ${remaining} course(s) with any grade` : ""
              }</div>`;
            }
            if (bNeeded <= coursesNeeded && bNeeded > 0) {
              const remaining = coursesNeeded - bNeeded;
              gradeBreakdown += `<div>â€¢ <strong>${bNeeded}</strong> B's${
                remaining > 0 ? ` + ${remaining} course(s) with any grade` : ""
              }</div>`;
            }
            if (bMinusNeeded <= coursesNeeded && bMinusNeeded > 0) {
              const remaining = coursesNeeded - bMinusNeeded;
              gradeBreakdown += `<div>â€¢ <strong>${bMinusNeeded}</strong> B-'s${
                remaining > 0 ? ` + ${remaining} course(s) with any grade` : ""
              }</div>`;
            }

            gradeBreakdown += `</div></div>`;
          }

          gradResultText.innerHTML = `âœ… You can graduate with your target CGPA of <strong>${targetCgpa.toFixed(
            2
          )}</strong> without retakes!<br>
            Complete the remaining <strong>${remainingCredits}</strong> credits with an average of <strong>${avgGradeNeeded.toFixed(
            2
          )}</strong> (${gradeText}).${gradeBreakdown}`;
          gradResultDiv.style.background =
            "linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(22, 163, 74, 0.15))";
          gradResultDiv.style.borderColor = "rgba(34, 197, 94, 0.4)";
          gradScenariosDiv.style.display = "none";
        }

        gradResultDiv.style.display = "block";
      }

      addCourseBtn.addEventListener("click", () => {
        addRetakeRow();
        messageEl.textContent = "Added a new retake row.";
      });

      calcBtn.addEventListener("click", calculate);
      document
        .getElementById("calculateTargetBtn")
        .addEventListener("click", calculateTargetRetakes);
      document
        .getElementById("calculateGradBtn")
        .addEventListener("click", calculateGraduation);

      initializeRows();
    </script>
    <script src="script.js"></script>
    <script src="buttons.js"></script>
  </body>
</html>
